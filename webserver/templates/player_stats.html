<html>
<head>
	<title>Player Stats - Awesome TF2 Data Scanner</title>
	<link rel="stylesheet" type="text/css" href="/static/styling.css" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script>
	$(document).ready(function(){
		console.log("ready script read");
		$("#submit").click(function(){
			console.log("submit button clicked");
			$.ajax({
				type: "POST",
				url: "/player_stats/",
				data: {attr:document.getElementById("attr").value,
					   attr_val:document.getElementById("attr_val").value},
				dataType: "json",
				success: function(stats){
					var medOrig = document.getElementById("medresults").innerHTML;
					var nonMedOrig = document.getElementById("nonmedresults").innerHTML;
					console.log("nonMedText:"+nonMedOrig + "."+nonMedOrig.length);
					var medText = medOrig;
					var nonMedText = nonMedOrig;
					var errorText = "";
					$("#debug").html(JSON.stringify(stats) + "<br>"); // for debugging
					if(stats.data.length>0){
						for(i=0;i<stats.data.length;i++){
							console.log(stats.data[i].class);
							if(stats.data[i].class=="medic"){ // display first, include HealsPerMin, Ubers, and Drops
								if(medOrig.length==0){
									medText+="<tr class=\"trcenter\"><td>Name</td><td>Class</td><td>Kills</td><td>Assists</td><td>Deaths</td><td>KA/D</td><td>HPM</td><td>Ubers</td><td>Drops</td><td>U/D</td></tr>";
								}
								var row=stats.data[i];
								medText+="<tr class=\"trright\"><td class=\"tdleft\">";
								medText+=row.name+"</td><td>";
								medText+=row.class+"</td><td>";
								medText+=row.kills+"</td><td>";
								medText+=row.assists+"</td><td>";
								medText+=row.deaths+"</td><td>";
								medText+=row.kad+"</td><td>";
								medText+=row.healspermin+"</td><td>";
								medText+=row.ubers+"</td><td>";
								medText+=row.drops+"</td><td>";
								medText+=row.ubers/row.drops+"</td></tr>";
							}
						} // close medic stat display loop
						
						for(i=0;i<stats.data.length;i++){
							var row=stats.data[i];
							if(row.class!="medic"){ // show DPM, hide ubers and drops
								if(nonMedOrig.length==0){
									console.log("adding headers for new player");
									nonMedText+="<tr class=\"trcenter\"><td>Name</td><td>Class</td><td>Kills</td><td>Assists</td><td>Deaths</td><td>KA/D</td><td>DPM</td></tr>";
								}
								
								console.log("adding player to existing");
								nonMedText+="<tr class=\"trright\"><td class=\"tdleft\">";
						
								nonMedText+=row.name+"</td><td>";
								nonMedText+=row.class+"</td><td>";
								nonMedText+=row.kills+"</td><td>";
								nonMedText+=row.assists+"</td><td>";
								nonMedText+=row.deaths+"</td><td>";
								nonMedText+=row.kad+"</td><td>";
								nonMedText+=row.damagepermin+"</td></tr>";
							}
						} // close stat display loop
					} // close non-empty stat display
					else{
						errorText+="Error: a player with that name/ID was not found";
					}
					$("#medresults").html(medText);
					$("#nonmedresults").html(nonMedText);
					$("#error").html(errorText);
					//$("#form").html("Add another player:<br>"+document.getElementById("form").innerHTML);
				}
			});
		});
	});
	</script>
</head>
<body>
	<table class="tblcenter">
		<tr><td class="tdcenter"><h1>Team Fortress 2 Data Scanner</h1>
		<br></td></tr>
		
		<tr><td><h2>Search for Players</h2></td></tr>
		<tr><td>
			<div id="debug"></div>
			<table id="medresults"></table>
			<table id="nonmedresults"></table><br>
			<div id="error"><!-- error messages go here --></div>
			<div id="form">
				<select name="attr" id="attr">
					<option value="name">Name</option>
					<option value="id">Steam3ID</option>
				</select>
				<input type="text" name="attr_val" id="attr_val"/>
				<button id="submit">Submit</button>
			</div>
		</td></tr>
		<tr><td><a href="/player_stats">Clear all</a></td></tr>
	</table>
	<br><br><div id="return"><a href="/">Back to index</a></div>
</body>
</html>